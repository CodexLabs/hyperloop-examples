/**
 * Hyperloop Metabase Generator
 * Copyright (c) 2015 by Appcelerator, Inc.
 */
var gen = require('./generate/index');

// for testing
if (module.id === ".") {
	var fs = require('fs');
	!fs.existsSync('build') && fs.mkdirSync('build');
	!fs.existsSync('build/hyperloop') && fs.mkdirSync('build/hyperloop');

	fs.writeFileSync('build/hyperloop/example.js', '\n'+
	'(function() {var MyClass=Hyperloop.defineClass("MyClass","UIView");\n' +
	'MyClass.addMethod({\n'+
	'selector:"drawRect:", encoding:"v@:{CGRect={CGPoint=dd}{CGSize=dd}}", callback:function() { },\n' +
	'})\n' +
	'MyClass.addMethod({\n'+
	'selector:"foo", encoding:"@@:", callback:function() { }\n' +
	'})\n' +
	'MyClass.addMethod({\n'+
	'selector:"charstar", encoding:"*@:", callback:function() { }\n' +
	'})\n' +
	'MyClass.addMethod({\n'+
	'selector:"intpointer", encoding:"^i@:", callback:function() { }\n' +
	'})\n' +
	'MyClass.addMethod({\n'+
	'selector:"float", encoding:"f@:", callback:function() { }\n' +
	'})' +
	'})();');

	var state = gen.parse('build/hyperloop/example.js');
	gen.generate('build/hyperloop', 'build/metabase-9.0-iphonesimulator-8d8d67e2682c5613536037287ce5a7d1.json', state, function (err) {
		if (err) {
			console.error(err);
			process.exit(1);
		}
	});
}
